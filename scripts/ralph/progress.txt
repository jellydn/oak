# Ralph Progress Log
Started: Thu Feb 12 23:13:46 +08 2026
---

## Codebase Patterns
- Swift Package Manager is used instead of Xcode project files (more reliable for CLI builds)
- Notch companion is a borderless, non-activating panel window positioned at top-center of screen
- Session state uses enum with associated values (SessionState) for type-safe state machine
- ViewModels are marked with @MainActor and use @Published for SwiftUI binding
- Timer uses Timer.scheduledTimer with weak self to avoid retain cycles
- Use `swift build` from Oak/ directory to build and verify typecheck
- Use UserDefaults for simple persistence needs in MVP (easier than Core Data for simple key-value storage)
- Run `xcodegen generate` in Oak/ directory after adding new Swift files to regenerate Xcode project

## [2026-02-12 23:23] - US-001
Session: N/A
- What was implemented:
  - Created macOS app project with Swift and SwiftUI using Swift Package Manager
  - Implemented notch companion UI (NotchWindowController) that displays as floating panel at top-center
  - Added NotchCompanionView with SwiftUI for the UI
  - Implemented FocusSessionViewModel with timer functionality
  - Created SessionModels with SessionState enum and Preset enum
  - Primary action button starts 25-minute focus session (with preset selection for 25/5 or 50/10)
  - Session state changes to running immediately on button click
- Files changed:
  - Oak/Package.swift - Swift Package Manager configuration
  - Oak/Sources/Oak/Oak.swift - Main app with all code (merged for SPM)
  - Oak/Oak/OakApp.swift - App entry point
  - Oak/Oak/Models/SessionModels.swift - SessionState and Preset enums
  - Oak/Oak/ViewModels/FocusSessionViewModel.swift - Timer and session logic
  - Oak/Oak/Views/NotchCompanionView.swift - SwiftUI notch interface
  - Oak/Oak/Views/NotchWindowController.swift - Window management
- **Learnings for future iterations:**
  - Swift Package Manager is easier to work with than manual Xcode project files for CLI builds
  - To build: `cd Oak && swift build` (builds successfully)
  - Notch window uses NSWindow with .borderless and .nonactivatingPanel style
  - NSApp.setActivationPolicy(.accessory) hides app from dock
  - Window level .floating keeps it above other windows
  - Use `[weak self]` in timer closures and invalidate in cleanup()
   - SwiftUI in AppKit requires NSHostingView wrapper
---

## [2026-02-12 23:37] - US-004
Session: N/A
- What was implemented:
  - Created AudioTrack enum with 6 ambient sound options: None, Rain, Forest, Cafe, Brown Noise, Lo-Fi
  - Implemented AudioManager service using AVAudioEngine for real-time ambient sound generation
  - Each track uses procedural audio generation (AVAudioSourceNode) for noise synthesis
  - Added volume control with slider (0-100%) and real-time adjustment
  - Integrated AudioManager into FocusSessionViewModel
  - Added audio button to NotchCompanionView that opens popover menu
  - AudioMenuView allows track selection and volume adjustment
  - Audio stops automatically when session completes (break session ends)
  - Notch UI expanded from 280px to 340px to accommodate audio button
- Files changed:
  - Oak/Oak/Models/AudioTrack.swift - New file with track enum and system icons
  - Oak/Oak/Services/AudioManager.swift - New service for audio playback
  - Oak/Oak/ViewModels/FocusSessionViewModel.swift - Integrated AudioManager
  - Oak/Oak/Views/NotchCompanionView.swift - Added audio button and popover menu
- **Learnings for future iterations:**
  - AVAudioEngine with AVAudioSourceNode enables real-time audio synthesis without external audio files
  - Brown noise uses recursive filtering for its characteristic deep sound
  - AVAudioSession must be configured with .playback category before playing audio
  - SwiftUI .popover modifier attaches to a view and shows a popover when bound @State is true
  - Main mixer node's outputVolume property controls overall engine volume
  - Always call audioEngine.stop() and remove taps in cleanup() to prevent memory leaks
  - Project needs xcodegen generate after adding new files to regenerate Xcode project
  - Build command: `just build` (runs xcodebuild in Oak/ directory)
---

## [2026-02-12 23:43] - US-005
Session: N/A
- What was implemented:
  - Added session-complete feedback animation to notch UI
  - Implemented isSessionComplete @Published property in FocusSessionViewModel
  - Added subtle scale pulse animation when session completes
  - Added green glow effect on notch border during completion animation
  - Animation is non-intrusive and doesn't steal keyboard focus (notch uses .nonactivatingPanel style)
  - Next state (break or idle) is clearly shown through existing currentSessionType property
- Files changed:
  - Oak/Oak/ViewModels/FocusSessionViewModel.swift - Added isSessionComplete state and animation trigger
  - Oak/Oak/Views/NotchCompanionView.swift - Added scale animation and glow effect
- **Learnings for future iterations:**
  - SwiftUI .scaleEffect() combined with .spring() animation provides smooth, subtle animations
  - .onChange(of:) modifier is useful for triggering animations when @Published properties change
  - Non-activating panel windows (.nonactivatingPanel) don't steal keyboard focus
  - For animations that should reset after a delay, use Task.sleep with @MainActor context
  - Visual feedback through border color changes is more subtle than full background flashes
  - The completion animation triggers after completeSession() but before the state changes to next interval
  - Build command: `just build` (typecheck passes)
---

## [2026-02-12 23:47] - US-006
Session: N/A
- What was implemented:
  - Created ProgressData model with date, focusMinutes, and completedSessions properties
  - Implemented ProgressManager service using UserDefaults for local persistence
  - Added streak calculation logic that counts consecutive days with completed sessions
  - Integrated progress tracking into FocusSessionViewModel to record work session completions
  - Added computed properties for accessing daily stats (todayFocusMinutes, todayCompletedSessions, streakDays)
  - Created ProgressMenuView that displays focus time, completed sessions, and streak
  - Added progress button to NotchCompanionView that shows popover with stats
  - Notch UI expanded from 340px to 380px to accommodate progress button
  - Progress button displays streak count when streak > 0, otherwise shows chart icon
- Files changed:
  - Oak/Oak/Models/ProgressData.swift - New file with progress data models
  - Oak/Oak/Services/ProgressManager.swift - New service for persistence and streak calculation
  - Oak/Oak/ViewModels/FocusSessionViewModel.swift - Added progress tracking integration
  - Oak/Oak/Views/NotchCompanionView.swift - Added progress button and menu
- **Learnings for future iterations:**
  - UserDefaults is sufficient for simple key-value storage in MVP (easier than Core Data)
  - Calendar.current.startOfDay() is essential for accurate daily record comparisons
  - Streak calculation requires iterating through records and checking consecutive days
  - JSONEncoder/JSONDecoder with UserDefaults works well for storing arrays of Codable structs
  - Progress tracking should record only completed work sessions (not break sessions)
  - The session duration should be calculated from session start time minus remaining time
  - Build command: `just build` (typecheck passes)
---
