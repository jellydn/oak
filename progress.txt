## [2026-02-13 00:24:00] - Initial setup
- Created prd.json from markdown PRD
- Initial code structure exists with basic implementation
- Tests pass

---

## [2026-02-13 00:26:00] - US-001
[Session: ]
- Notch companion is visible and interactive when app is running
- One primary action starts a 25-minute focus session
- Session state changes to running within 500ms of user click
- Typecheck/lint passes
- Files changed:
  - Oak/Tests/OakTests/US001Tests.swift (added)
  - Oak/Oak/ViewModels/FocusSessionViewModel.swift (added selectPreset method)
  - Oak/Oak/Views/NotchCompanionView.swift (removed Spacer)
- Tests: All 5 tests pass (1 smoke test + 4 US-001 tests)
**Learnings for future iterations:**
- Use `@MainActor` on ViewModels to ensure thread safety
- Test state transitions (idle → running → paused → idle)
- Test computed properties and edge cases (0 values, boundary conditions)
- XcodeGen project must be regenerated when adding new test files: `cd Oak && xcodegen generate`
- The project uses SwiftUI + AVFoundation stack for macOS 13+
- Tests should follow XCTest framework with @MainActor for ViewModels
- Commit format: `feat: [Story ID] - [Story Title]`

---

## [2026-02-13 00:26:00] - US-002
[Session: ]
- MVP supports only two presets: 25/5 and 50/10
- Users can switch preset before session start
- Work and break durations follow selected preset exactly
- Typecheck/lint passes
- Files changed:
  - Oak/Tests/OakTests/US002Tests.swift (added)
- Tests: All 10 tests pass (1 smoke + 4 US-001 + 5 US-002)
**Learnings for future iterations:**
- Test only public API - don't access private properties/methods in tests
- Use computed properties like `displayTime` instead of internal state for assertions
- The `selectPreset()` method already existed in FocusSessionViewModel from previous work
- Tests should verify both enum values and runtime behavior
- XcodeGen project regeneration required after adding test files: `cd Oak && xcodegen generate`

---

## [2026-02-13 00:27:00] - US-003
[Session: ]
- Active session can be paused and resumed from notch companion
- Remaining time is preserved exactly across pause/resume
- UI clearly indicates paused vs running state (orange color for paused)
- Typecheck/lint passes
- Files changed:
  - Oak/Tests/OakTests/US003Tests.swift (added)
  - AGENTS.md (modified)
- Tests: All 16 tests pass (1 smoke + 4 US-001 + 5 US-002 + 6 US-003)
**Learnings for future iterations:**
- Test state transitions ensure correct behavior at each state (idle, running, paused)
- Computed properties `isPaused` and `isRunning` are essential for UI state indication
- The UI uses orange color for paused state (NotchCompanionView.swift:111)
- Don't write tests that can't be properly executed - keep tests simple and focused
- Timer functionality is private - tests should verify through public API only

---

## [2026-02-13 00:30:00] - US-004
[Session: ]
- Built-in tracks available: rain, forest, cafe, brown noise, lo-fi
- User can select one track before or during session
- User can adjust volume from app controls (0.0 to 1.0, default 0.5)
- Audio stops automatically when session ends (both work and break sessions)
- Typecheck/lint passes
- Files changed:
  - Oak/Tests/OakTests/US004Tests.swift (added)
  - Oak/Oak/Services/AudioManager.swift (fixed selectedTrack bug)
  - Oak/Oak/ViewModels/FocusSessionViewModel.swift (added audio stop on work session end)
  - AGENTS.md (modified)
- Tests: All 21 tests pass (1 smoke + 4 US-001 + 5 US-002 + 6 US-003 + 5 US-004)
**Learnings for future iterations:**
- AudioManager.play() had a bug: selectedTrack was set before generateAmbientSound() called stop() which reset it
- Fix: Move selectedTrack assignment to after audio engine successfully starts
- Audio stops automatically when ANY session ends (work or break), not just break sessions
- AVAudioSourceNode is used for generating custom audio (no external files needed)
- Audio is synthesized in real-time using noise generation algorithms
- AudioManager uses AVAudioEngine for audio output with volume control
- git index lock file can persist - use `pkill -9 git` to kill stuck processes

---

## [2026-02-13 00:34:00] - US-005
[Session: ]
- Session completion triggers a short notch animation (0.3s spring effect with scale 1.05 and green border)
- Completion feedback does not steal keyboard focus (visual only, no alerts/modals)
- Next state (break or idle) is clearly shown (currentSessionType: "Focus" or "Break")
- Typecheck/lint passes
- Files changed:
  - Oak/Tests/OakTests/US005Tests.swift (added)
- Tests: All 27 tests pass (1 smoke + 4 US-001 + 5 US-002 + 6 US-003 + 5 US-004 + 6 US-005)
**Learnings for future iterations:**
- Completion animation uses SwiftUI's spring animation with response: 0.3 and dampingFraction: 0.7
- Visual feedback doesn't steal keyboard focus - avoid alerts/sheets/modals for completion
- Animation triggered via onChange(of: viewModel.isSessionComplete) modifier in NotchCompanionView
- Next state shown through computed property currentSessionType which returns "Break" after work or "Focus" after break
- SwiftUI animation modifiers: .scaleEffect() and .overlay() with stroke
- Green border appears when isSessionComplete is true (Color.green.opacity(0.5), lineWidth: 2)

---